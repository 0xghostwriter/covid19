---
layout: "page.njk"
title: "Resilience Roadmap"
meta: "California's roadmap for modifying the statewide order."
author: "State of California"
publishdate: "2020-03-23T22:00:00Z"
addtositemap: true
---
<script type="text/javascript" src="//d3js.org/d3.v3.min.js"></script>

<style type="text/css">
  #container {
    width: 800px;
  }

  svg {
    padding-left: 20px;
  }

  path {
    fill: #799dcb;
    stroke: #fff;
  }
  path.greenlit {
    fill: green;
    stroke: #fff;
  }
  path:hover {
    fill: #48494b;
    cursor: pointer;
  }

  #tooltip {
    width: 150px;
    height: auto;
    padding: 5px;
    background-color: #fff;
    color: #000;
    -webkit-border-radius: 5px;
    -moz-border-radius: 5px;
    border-radius: 5px;
    -webkit-box-shadow: 3px 3px 8px rgba(0, 0, 0, 0.4);
    -moz-box-shadow: 3px 3px 8px rgba(0, 0, 0, 0.4);
    box-shadow: 3px 3px 8px rgba(0, 0, 0, 0.4);
    pointer-events: none;
    position: absolute;
  }

  #tooltip.hidden {
    display: none;
  }

  #tooltip p {
    margin: 0;
    font-size: 14px;
    line-height: 18px;
  }
  .activity-details {
    position: absolute;
    top: 150px;
    left: 20px;
  }
</style>

<h2>What activities are open in each county?</h2>
<label id="SearchInput" for="q">Enter an activity</label>
<form action="/Search/" class="form-inline js-activity-form" autocomplete="off">
  <input type="text" class="form-control col-md-6" id="q" name="q" aria-labelledby="SearchInput" autofocus="">
  <button type="submit" class="btn btn-primary">Search</button>	  
</form>

<div class="activity-details"></div>
<div id="container"></div>

<div id="tooltip" class="hidden">
  <p><span id="county">County Name</span> County</p>
</div>

<script type="text/javascript">
  document.querySelector('.js-activity-form').addEventListener('submit',function(e) {
    e.preventDefault();
    let activity = document.querySelector('.js-activity-form input').value;
    update(activity);
  })

  function getCountyTooltip(county) {
    let message = county;
    countyStats.countyData.forEach(stat => {
      if(stat.COUNTY == county) {
        message = `${county} County<br>
        ${stat.TOTALCONFIRMEDCASES.toLocaleString()} Cases<br>
        ${stat.NUMBERDIED.toLocaleString()} Deaths`
      }
    })
    return message;
  }
  function highlightCounty(county) {
    document.querySelector('#county-Inyo').style.fill = 'red';
  }

  //Width and height
  var w;
  if(window.screen.width < 760) {
    w = window.innerWidth;
  } else {
    w = window.screen.width / 2;
  }
  var h = 1100;

  //Define map projection
  var projection = d3.geo
    .mercator()
    .center([-119, 37])
    .translate([w / 2, h / 2])
    .scale([w * 4.7]);

  //Define path generator
  var path = d3.geo.path().projection(projection);

  let enabledCounties = [];

  //Create SVG
  var svg = d3
    .select("#container")
    .append("svg")
    .attr("width", w)
    .attr("height", h);

  fetch('/js/maps/covidstats.json')
  .then(response => response.json())
  .then(data => {
    countyStats = data[0].todayCases;
    console.log(countyStats);
  });
  //Load in GeoJSON data
  d3.json("/js/maps/cb_2014_us_county_5m.json", function(err, json) {
    geojson = json;
    update();
  })

  function update(activity) {
    document.getElementById('container').innerHTML = '';

    svg = d3
    .select("#container")
    .append("svg")
    .attr("width", w)
    .attr("height", h);

    enabledCounties = [];
    svg
      .selectAll("path")
      .data(geojson.features)
      .enter()
      .append("path")
      .attr("d", path)
      .attr("id", function (d, i) {
        return "county-" + d.properties.NAME.replace(/ /g,'');
      })
      .attr("class", function (d, i) {
        // choose random on or off
        if(activity && Math.random() > 0.7) {
          enabledCounties.push(d.properties.NAME)
          return 'greenlit'
        } else {
          return 'nolit'
        }
      })
      //.attr("id",path.properties.name.replace(/ /g,''))
      .on("mouseover", function (d) {
        var xPosition = parseFloat(d3.mouse(this)[0]);
        var yPosition = parseFloat(d3.mouse(this)[1] + 170);
        d3.select("#tooltip")
          .style("left", xPosition + "px")
          .style("top", yPosition + "px");
        d3.select("#county").html(getCountyTooltip(`${d.properties.NAME}`));
        d3.select("#tooltip").classed("hidden", false);
      })
      .on("mouseout", function () {
        d3.select("#tooltip").classed("hidden", true);
      });
    if(activity) {
      document.querySelector('.activity-details').innerHTML = `<strong>${activity}</strong> is a go in the following counties: ${enabledCounties.toString()}`;
    }
  }
</script>